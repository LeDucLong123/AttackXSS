<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Create Post</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>Test Tạo Bài Viết</h3>
                    </div>
                    <div class="card-body">
                        <!-- Login Section -->
                        <div id="loginSection">
                            <h5>1. Đăng nhập</h5>
                            <form id="loginForm">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="loginAccount" placeholder="Tài khoản"
                                        value="testuser">
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" id="loginPassword"
                                        placeholder="Mật khẩu" value="password123">
                                </div>
                                <button type="submit" class="btn btn-primary">Đăng nhập</button>
                            </form>
                            <hr>
                        </div>

                        <!-- Create Post Section -->
                        <div id="createPostSection">
                            <h5>2. Tạo bài viết</h5>
                            <form id="createPostForm">
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="postTitle"
                                        placeholder="Tiêu đề bài viết">
                                </div>
                                <div class="mb-3">
                                    <textarea class="form-control" id="postContent" rows="4"
                                        placeholder="Nội dung bài viết"></textarea>
                                </div>
                                <button type="submit" class="btn btn-success">Tạo bài viết</button>
                            </form>
                            <hr>
                        </div>

                        <!-- Results -->
                        <div id="results">
                            <h5>3. Kết quả</h5>
                            <div id="resultContent" class="alert alert-info">
                                Chưa có kết quả...
                            </div>
                        </div>

                        <!-- Navigation -->
                        <div class="mt-4">
                            <a href="/blog" class="btn btn-outline-primary">Xem Blog</a>
                            <a href="/auth" class="btn btn-outline-secondary">Trang Auth</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let sessionCookie = '';

        // Login function
        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const account = document.getElementById('loginAccount').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ account, password })
                });

                const data = await response.json();
                updateResult(`Login: ${data.message}`, data.success ? 'success' : 'danger');

                if (data.success) {
                    // Cookie sẽ được set tự động bởi browser
                    console.log('Login successful!');
                }
            } catch (error) {
                updateResult(`Login error: ${error.message}`, 'danger');
            }
        });

        // Create post function
        document.getElementById('createPostForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;

            if (!title || !content) {
                updateResult('Vui lòng điền đầy đủ tiêu đề và nội dung!', 'warning');
                return;
            }

            try {
                const response = await fetch('/blog', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title, content })
                });

                const data = await response.json();
                updateResult(`Create Post: ${data.message}`, data.success ? 'success' : 'danger');

                if (data.success) {
                    // Reset form
                    document.getElementById('createPostForm').reset();
                    console.log('Post created:', data.post);
                }
            } catch (error) {
                updateResult(`Create post error: ${error.message}`, 'danger');
            }
        });

        function updateResult(message, type) {
            const resultDiv = document.getElementById('resultContent');
            resultDiv.className = `alert alert-${type}`;
            resultDiv.innerHTML = message + '<br>' + new Date().toLocaleTimeString();
        }
    </script>
</body>

</html>